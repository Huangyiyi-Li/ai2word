<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AiToWords - AI对话导出</title>
    <link rel="stylesheet" href="sidepanel.css">
</head>

<body>
    <div class="container">
        <!-- 顶部标题栏 -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">📄</span>
                <h1>AiToWords</h1>
            </div>
            <div style="display:flex; gap:8px;">
                <button class="icon-btn" onclick="i18n.toggle()" title="中/En">🌐</button>
                <button id="settingsBtn" class="icon-btn" title="设置">⚙️</button>
                <button id="refreshBtn" class="icon-btn" title="刷新扫描">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 4v6h6M23 20v-6h-6" />
                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- 平台状态提示 -->
        <div id="platformStatus" class="platform-status">
            <span class="status-dot"></span>
            <span class="status-text" data-i18n="waitingStatus">等待检测AI平台...</span>
        </div>

        <!-- 工具栏 -->
        <div class="toolbar">
            <button id="selectAllBtn" class="btn btn-secondary btn-sm">
                <span data-i18n="selectAll">全选</span>
            </button>
            <button id="selectAssistantBtn" class="btn btn-secondary btn-sm">
                <span data-i18n="selectAssistant">仅AI回复</span>
            </button>
            <span class="selected-count" id="selectedCount" data-i18n="selectedCount">已选: 0</span>
        </div>

        <!-- 消息列表 -->
        <div id="messageList" class="message-list">
            <div class="empty-state">
                <div class="empty-icon">💬</div>
                <p data-i18n="emptyState">打开任意 AI 对话页面</p>
                <p class="empty-hint" data-i18n="emptyHint">支持 ChatGPT、Claude、DeepSeek、通义千问、文心一言、Kimi</p>
            </div>
        </div>

        <!-- 底部操作区 -->
        <footer class="footer">
            <button id="exportBtn" class="btn btn-primary" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="7,10 12,15 17,10" />
                    <line x1="12" y1="15" x2="12" y2="3" />
                </svg>
                <span data-i18n="exportBtn">导出 Word</span>
            </button>
        </footer>
    </div>

    <!-- 粘贴/手动输入模式 -->
    <div id="manualMode" class="manual-mode hidden">
        <div class="manual-header">
            <button id="backToListBtn" class="icon-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15,18 9,12 15,6" />
                </svg>
            </button>
            <h2>手动输入</h2>
        </div>
        <textarea id="manualInput" data-i18n="manualPlaceholder" placeholder="粘贴 Markdown 内容..."></textarea>
        <button id="manualExportBtn" class="btn btn-primary">
            <span data-i18n="manualExportBtn">导出 Word</span>
        </button>
    </div>

    <!-- 模式切换 -->
    <button id="switchModeBtn" class="switch-mode-btn" title="切换到手动输入模式">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 20h9" />
            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
        </svg>
    </button>

    <!-- 设置面板 -->
    <div id="settingsPanel" class="settings-panel hidden">
        <div class="settings-header">
            <button id="backFromSettingsBtn" class="icon-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15,18 9,12 15,6" />
                </svg>
            </button>
            <h2>⚙️ 设置</h2>
        </div>

        <!-- 网站权限管理 -->
        <div class="settings-section">
            <h3 class="settings-section-title">🌐 支持的网站</h3>
            <p class="settings-hint">管理插件可访问的 AI 对话网站</p>
            <div class="host-input-row">
                <input type="text" id="hostInput" class="host-input" placeholder="输入网站域名，如 example.com">
                <button id="addHostBtn" class="btn btn-sm btn-primary">添加</button>
            </div>
            <button id="addCurrentPageBtn" class="btn btn-secondary btn-sm" style="width:100%; margin-top:8px;">
                📌 添加当前页面
            </button>
            <div id="hostList" class="host-list"></div>
        </div>

        <!-- 转换设置 -->
        <div class="settings-section">
            <h3 class="settings-section-title">📝 导出设置</h3>
            <div class="setting-item">
                <div class="setting-label">
                    <span>保留标题内联样式</span>
                    <span class="setting-desc">标题中的粗体/斜体等样式同步到 Word</span>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="settingPreserveHeadingStyle" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-label">
                    <span>保留粗体格式</span>
                    <span class="setting-desc">Markdown **粗体** 同步到 Word</span>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="settingPreserveBold" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-label">
                    <span>保留斜体格式</span>
                    <span class="setting-desc">Markdown *斜体* 同步到 Word</span>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="settingPreserveItalic" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-label">
                    <span>去除多余空格</span>
                    <span class="setting-desc">去除 AI 生成内容中标点前的多余空格</span>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="settingRemoveExtraSpaces">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-label">
                    <span>引用块使用斜体</span>
                    <span class="setting-desc">blockquote 在 Word 中以斜体显示</span>
                </div>
                <label class="toggle">
                    <input type="checkbox" id="settingBlockquoteItalic" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
    </div>

    <script src="../lib/docx.min.js"></script>
    <script src="../lib/temml.min.js"></script>
    <script src="../lib/jszip.min.js"></script>
    <script src="../lib/mermaid.min.js"></script>
    <script src="../lib/mermaid.min.js"></script>
    <script src="../lib/html-to-md.js"></script>
    <script src="../lib/i18n.js"></script>
    <script src="../lib/converter.js"></script>
    <script src="sidepanel.js"></script>
</body>

</html>