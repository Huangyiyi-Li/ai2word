# PRD: 增强型 LaTeX 解析与跨平台导出系统

## 1. 目标描述

本项目旨在提供一个高兼容性的 Markdown 转 Docx 工具，重点解决 AI 场景下公式多变、格式复杂、平台兼容性差的问题。

## 2. 核心功能需求

### 2.1 高兼容性 LaTeX 解析

- **多 Delimiter 支持**：系统必须同时识别 `$`, `$$`, `\(`, `\[` 四种标记。
- **容错性解析**：针对 AI 生成内容中常见的 `\` 与 `[` 之间存在空白字符/换行符的情况，系统具备强大识别能力。
- **块级打断逻辑**：在解析 Markdown 段落时，若遇到公式块标记，能强制切断当前段落，确保公式排版。

### 2.2 Word 原生公式转换

- **MathML 桥接**：利用 Temml 库将 LaTeX 实时转换为 MathML。
- **OMML 注入**：通过 XSLT 转换器将 MathML 转为 Word 专用的 OMML 格式，并利用 JSZip 底层注入，确保导出的公式在 Word 中是**原生可编辑**状态。

### 2.3 高级内容转换支持

- **Mermaid 渲染**：支持流程图、时序图等。系统自动将 SVG 转为 PNG 并嵌入 Word。
- **任务列表 (Task Lists)**：识别 `[ ]` 和 `[x]`，导出为带复选框符号 (`☐`/`☑`) 的格式。
- **脚注 (Footnotes)**：支持标准 `[^1]` 语法。导出为 Word **原生脚注**（支持双向跳转）。
- **富文本行内样式**：
  - **递归解析**：支持粗体、斜体、删除线、行内代码的嵌套组合。
  - **超链接**：识别 `[text](url)` 并导出为 Word 原生可点击链接。

### 2.4 独立 Web 运行能力

- **环境自适应**：核心转换逻辑自动识别 `chrome-extension` 或 Web 环境，动态切换资源加载。
- **独立性**：Web 版包含完整依赖，可脱离插件独立部署。

## 3. 验收标准

1. **LaTeX**：复杂公式（如 cases 环境）导出后可编辑。
2. **脚注**：点击文中引用编号可跳转至页脚。
3. **超链接**：导出后链接有效且显示样式正确。
4. **Mermaid**：图表清晰显示，无截断。

---
*版本：v2.1*
*日期：2026-02-04*
